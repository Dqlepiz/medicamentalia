<nav id="top" class="navbar navbar-default">
  <div class="container-fluid">
    
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="{{ site.url }}" title="{{ site.title }}">{{ site.title }}</a>
    </div>

    <div id="main-menu" class="collapse navbar-collapse">
      <ul id="menu-main-menu" class="nav navbar-nav navbar-right">
        
        {% for nav in site.data.nav %}

          {% if nav.type == 'article' %}
            {% assign articles_items=site.articles | where:"ref", nav.ref %}
            {% for item in articles_items %}
              {% if item.lang == page.lang %}
              <li class="menu-item {% if item.ref == page.ref %}current-menu-item{% endif %}">
                <a href="/articles/{{ item.slug }}" title="{{ item.title }}">{{ item.title }}</a>
              </li>
              {% endif %}
            {% endfor %}

          {% else if nav.type == 'page' %}
            {% assign page_item=site.pages | where:"ref", nav.ref %}
            {% for item in page_item %}
              {% if item.lang == page.lang %}
              <li class="menu-item {% if item.ref == page.ref %}current-menu-item{% endif %}">
                <a href="{{ item.permalink }}" title="{{ item.title }}">{{ item.title }}</a>
              </li>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endfor %}

        <li class="menu-item menu-item-language">
          <a href="#" onclick="return false">{{ site.data.locales[page.lang].lang }}</a>
          <ul class="sub-menu submenu-languages">
            {% if page.collection %}
              {% assign articles=site.articles | where:"ref", page.ref | sort: 'lang' %}
              {% for item in articles %}
                {% if item.lang != page.lang %}
                <li class="menu-item menu-item-language menu-item-language-current">
                  <a href="/articles/{{ item.slug }}" class="{{ item.lang }}" title="{{ site.data.locales[item.lang].lang }}">{{ site.data.locales[item.lang].lang }}</a>
                </li>
                {% endif %}
              {% endfor %}
            {% else %}
              {% assign pages=site.pages | where:"ref", page.ref | sort: 'lang' %}
              {% for item in pages %}
                {% if item.lang != page.lang %}
                <li>
                  <a href="{{ item.permalink }}" class="{{ item.lang }}" title="{{ site.data.locales[item.lang].lang }}">{{ site.data.locales[item.lang].lang }}</a>
                </li>
                {% endif %}
              {% endfor %}
            {% endif %}
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
